(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const D=Symbol("Comlink.proxy"),q=Symbol("Comlink.endpoint"),Y=Symbol("Comlink.releaseProxy"),I=Symbol("Comlink.finalizer"),C=Symbol("Comlink.thrown"),$=t=>typeof t=="object"&&t!==null||typeof t=="function",X={canHandle:t=>$(t)&&t[D],serialize(t){const{port1:e,port2:n}=new MessageChannel;return R(t,e),[n,[n]]},deserialize(t){return t.start(),K(t)}},Z={canHandle:t=>$(t)&&C in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},F=new Map([["proxy",X],["throw",Z]]);function B(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function R(t,e=globalThis,n=["*"]){e.addEventListener("message",function g(r){if(!r||!r.data)return;if(!B(n,r.origin)){console.warn(`Invalid origin '${r.origin}' for comlink proxy`);return}const{id:f,type:u,path:l}=Object.assign({path:[]},r.data),s=(r.data.argumentList||[]).map(M);let a;try{const c=l.slice(0,-1).reduce((o,h)=>o[h],t),i=l.reduce((o,h)=>o[h],t);switch(u){case"GET":a=i;break;case"SET":c[l.slice(-1)[0]]=M(r.data.value),a=!0;break;case"APPLY":a=i.apply(c,s);break;case"CONSTRUCT":{const o=new i(...s);a=ot(o)}break;case"ENDPOINT":{const{port1:o,port2:h}=new MessageChannel;R(t,h),a=nt(o,[o])}break;case"RELEASE":a=void 0;break;default:return}}catch(c){a={value:c,[C]:0}}Promise.resolve(a).catch(c=>({value:c,[C]:0})).then(c=>{const[i,o]=P(c);e.postMessage(Object.assign(Object.assign({},i),{id:f}),o),u==="RELEASE"&&(e.removeEventListener("message",g),H(e),I in t&&typeof t[I]=="function"&&t[I]())}).catch(c=>{const[i,o]=P({value:new TypeError("Unserializable return value"),[C]:0});e.postMessage(Object.assign(Object.assign({},i),{id:f}),o)})}),e.start&&e.start()}function J(t){return t.constructor.name==="MessagePort"}function H(t){J(t)&&t.close()}function K(t,e){const n=new Map;return t.addEventListener("message",function(r){const{data:f}=r;if(!f||!f.id)return;const u=n.get(f.id);if(u)try{u(f)}finally{n.delete(f.id)}}),T(t,n,[],e)}function x(t){if(t)throw new Error("Proxy has been released and is not useable")}function N(t){return E(t,new Map,{type:"RELEASE"}).then(()=>{H(t)})}const S=new WeakMap,A="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(S.get(t)||0)-1;S.set(t,e),e===0&&N(t)});function Q(t,e){const n=(S.get(e)||0)+1;S.set(e,n),A&&A.register(t,e,t)}function tt(t){A&&A.unregister(t)}function T(t,e,n=[],g=function(){}){let r=!1;const f=new Proxy(g,{get(u,l){if(x(r),l===Y)return()=>{tt(f),N(t),e.clear(),r=!0};if(l==="then"){if(n.length===0)return{then:()=>f};const s=E(t,e,{type:"GET",path:n.map(a=>a.toString())}).then(M);return s.then.bind(s)}return T(t,e,[...n,l])},set(u,l,s){x(r);const[a,c]=P(s);return E(t,e,{type:"SET",path:[...n,l].map(i=>i.toString()),value:a},c).then(M)},apply(u,l,s){x(r);const a=n[n.length-1];if(a===q)return E(t,e,{type:"ENDPOINT"}).then(M);if(a==="bind")return T(t,e,n.slice(0,-1));const[c,i]=L(s);return E(t,e,{type:"APPLY",path:n.map(o=>o.toString()),argumentList:c},i).then(M)},construct(u,l){x(r);const[s,a]=L(l);return E(t,e,{type:"CONSTRUCT",path:n.map(c=>c.toString()),argumentList:s},a).then(M)}});return Q(f,t),f}function et(t){return Array.prototype.concat.apply([],t)}function L(t){const e=t.map(P);return[e.map(n=>n[0]),et(e.map(n=>n[1]))]}const _=new WeakMap;function nt(t,e){return _.set(t,e),t}function ot(t){return Object.assign(t,{[D]:!0})}function P(t){for(const[e,n]of F)if(n.canHandle(t)){const[g,r]=n.serialize(t);return[{type:"HANDLER",name:e,value:g},r]}return[{type:"RAW",value:t},_.get(t)||[]]}function M(t){switch(t.type){case"HANDLER":return F.get(t.name).deserialize(t.value);case"RAW":return t.value}}function E(t,e,n,g){return new Promise(r=>{const f=rt();e.set(f,r),t.start&&t.start(),t.postMessage(Object.assign({id:f},n),g)})}function rt(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const d=6;function st(t,e){const n=Math.floor(t/d),g=t%d,r=Math.floor(e/d),f=e%d,u=Math.abs(n-r),l=Math.abs(g-f);return u===1&&l===0||u===0&&l===1}function z(t){const e=d*d;let n=0;const g=[];function r(s){const a=t.find(c=>c.index===s);return a?a.value:null}function f(s,a,c){if(n>=5)return;if(s.length===e){n++,g.push([...s]);return}const i=s[s.length-1];for(let o=0;o<e;o++){if(a.has(o)||!st(i,o))continue;const h=r(o);h!==null&&h!==c||(a.add(o),s.push(o),f(s,a,h===c?c+1:c),s.pop(),a.delete(o))}}const u=t.find(s=>s.value===1);if(!u)return{count:0,solutions:[]};const l=new Set([u.index]);return f([u.index],l,2),{count:n,solutions:g}}function at(){const t=d*d,e=[],n=new Set;function g(u){const l=[],s=Math.floor(u/d),a=u%d,c=[[-1,0],[1,0],[0,-1],[0,1]];for(const[i,o]of c){const h=s+i,p=a+o;h>=0&&h<d&&p>=0&&p<d&&l.push(h*d+p)}for(let i=l.length-1;i>0;i--){const o=Math.floor(Math.random()*(i+1));[l[i],l[o]]=[l[o],l[i]]}return l}function r(u){if(e.push(u),n.add(u),e.length===t)return!0;const l=g(u);l.sort((s,a)=>{const c=g(s).filter(o=>!n.has(o)).length,i=g(a).filter(o=>!n.has(o)).length;return c-i});for(const s of l)if(!n.has(s)&&r(s))return!0;return e.pop(),n.delete(u),!1}const f=Math.floor(Math.random()*t);return r(f)?e.map(u=>({row:Math.floor(u/d),col:u%d,index:u})):null}function it(){const t=d*d,e=50;let n=0;for(console.log("[Worker] Starting puzzle generation...");n<e;){let s=function(b,w){const m=[0,b.length-1];for(;m.length<w;){let y=-1,j=-1/0;for(let k=1;k<b.length-1;k++){if(m.includes(k))continue;let O=1/0,W=1/0;for(let v of m){const U=b[v],G=b[k],lt=Math.abs(G.row-U.row)+Math.abs(G.col-U.col);O=Math.min(O,lt);const ct=Math.abs(k-v);W=Math.min(W,ct)}const V=O+W/b.length*.15;V>j&&(j=V,y=k)}if(y!==-1)m.push(y);else break}return m},c=function(b){return Array.from(b).sort((m,y)=>m-y).map((m,y)=>({index:g[m].index,value:y+1}))};const g=at();if(!g){n++;continue}const r=new Set,l=({25:{intermediate:4},36:{intermediate:6},49:{intermediate:8},64:{intermediate:10}}[t]||{intermediate:6}).intermediate;console.log(`[Worker] Placing ${l+2} total clues for ${t} cells`);const a=s(g,l+2);console.log(`[Worker] Smart placement returned ${a.length} clue indices`),a.forEach(b=>r.add(b));let i=c(r),o=z(i);console.log(`[Worker] Attempt ${n+1} Initial: ${o.count} solution(s)`);const h=15;let p=0;for(;o.count>1&&p<h;){const b=g.map(y=>y.index),w=o.solutions[0].toString()===b.toString()?o.solutions[1]:o.solutions[0];if(!w)break;let m=-1;for(let y=0;y<t;y++)if(b[y]!==w[y]){m=y;break}m!==-1&&(r.has(m)||(r.add(m),i=c(r),console.log(`[Worker] Fix ${p+1}: Added clue at step ${m+1}`))),o=z(i),p++}if(o.count>1&&p>=h){console.log("[Worker] Fallback: Adding 2 extra clues");const b=[Math.floor(t/3),Math.floor(t*2/3)];for(const w of b)r.has(w)||r.add(w);i=c(r),o=z(i),console.log(`[Worker] After fallback: ${o.count} solution(s), ${r.size} total clues`)}if(o.count===1)return console.log(`[Worker] ✅ Found unique puzzle with ${i.length} clues!`),{numbers:i,solution:o.solutions[0],clueCount:i.length,attempts:n+1};n++}return console.warn("[Worker] ⚠️ Could not find unique solution after",e,"attempts"),null}R({generatePuzzle:it,solvePuzzle:z})})();
